<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ö–†–ò–ü–¢–û –ë–ê–ù–ö ¬∑ –§–ò–ù–ê–õ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', 'Segoe UI', monospace;
        }

        body {
            background: #0a0a0f;
            min-height: 100vh;
            padding: 20px;
            color: #e0b3ff;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: radial-gradient(circle at 30% 50%, #8b5cf620 0%, #0a0a0f 70%);
            animation: toxicPulse 8s ease infinite;
            pointer-events: none;
            z-index: 0;
        }

        @keyframes toxicPulse {
            0% { opacity: 0.5; }
            50% { opacity: 1; }
            100% { opacity: 0.5; }
        }

        .app {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 10;
        }

        /* –û–ö–ù–û –í–•–û–î–ê */
        .auth-wrapper {
            max-width: 500px;
            margin: 50px auto;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .auth-glass {
            background: rgba(18, 10, 26, 0.8);
            backdrop-filter: blur(12px);
            border: 2px solid #8b5cf6;
            border-radius: 40px;
            padding: 35px;
            box-shadow: 0 0 50px #8b5cf6;
        }

        .auth-title {
            font-size: 48px;
            font-weight: 800;
            text-align: center;
            background: linear-gradient(135deg, #8b5cf6, #ff00aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .auth-subtitle {
            text-align: center;
            color: #e0b3ff;
            margin-bottom: 30px;
            font-size: 16px;
        }

        .auth-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
        }

        .auth-tab {
            flex: 1;
            padding: 18px 0;
            background: rgba(139, 92, 246, 0.1);
            border: 2px solid #8b5cf6;
            border-radius: 50px;
            color: #e0b3ff;
            font-weight: 600;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .auth-tab:hover {
            background: #8b5cf6;
            color: #0a0a0f;
        }

        .auth-tab.active {
            background: #8b5cf6;
            color: #0a0a0f;
        }

        .auth-form {
            transition: all 0.3s ease;
        }

        .auth-input-group {
            margin-bottom: 20px;
        }

        .auth-label {
            display: block;
            color: #8b5cf6;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .auth-input {
            width: 100%;
            padding: 18px 25px;
            background: rgba(18, 10, 26, 0.9);
            border: 2px solid #8b5cf6;
            border-radius: 30px;
            color: #e0b3ff;
            font-size: 16px;
            transition: all 0.3s;
        }

        .auth-input:focus {
            outline: none;
            border-color: #ff00aa;
        }

        .auth-input.error {
            border-color: #ff0000;
            box-shadow: 0 0 20px #ff0000;
            animation: shake 0.3s ease;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            75% { transform: translateX(5px); }
        }

        .auth-btn {
            width: 100%;
            padding: 18px;
            background: linear-gradient(135deg, #8b5cf6, #ff00aa);
            border: none;
            border-radius: 50px;
            color: #0a0a0f;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
            margin-top: 10px;
        }

        .auth-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 0 30px #ff00aa;
        }

        .auth-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }

        .auth-info {
            margin-top: 20px;
            padding: 15px;
            background: rgba(139, 92, 246, 0.1);
            border-radius: 30px;
            text-align: center;
            color: #e0b3ff;
            font-size: 14px;
        }

        .danger-btn {
            background: #ff0000;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            cursor: pointer;
            margin-top: 10px;
            width: 100%;
        }

        .danger-btn:hover {
            background: #ff4444;
            transform: translateY(-2px);
        }

        /* –û–°–ù–û–í–ù–´–ï –°–¢–ò–õ–ò */
        .toxic-glass {
            background: rgba(18, 10, 26, 0.8);
            backdrop-filter: blur(12px);
            border: 2px solid #8b5cf6;
            border-radius: 30px;
            padding: 25px;
            box-shadow: 0 0 30px #8b5cf6;
        }

        .profile-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            flex-wrap: wrap;
            gap: 20px;
        }

        .profile-card {
            display: flex;
            align-items: center;
            gap: 25px;
            background: rgba(18, 10, 26, 0.9);
            padding: 15px 35px;
            border-radius: 60px;
            border: 2px solid #8b5cf6;
            cursor: pointer;
        }

        .avatar {
            width: 70px;
            height: 70px;
            background: linear-gradient(135deg, #8b5cf6, #ff00aa);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            color: #0a0a0f;
            border: 3px solid #ff00aa;
            position: relative;
        }

        .clan-tag-badge {
            position: absolute;
            bottom: -5px;
            left: -5px;
            background: #8b5cf6;
            color: white;
            padding: 3px 8px;
            border-radius: 15px;
            font-size: 10px;
            font-weight: 700;
        }

        .role-badge {
            position: absolute;
            bottom: -5px;
            right: -5px;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 12px;
            font-weight: 800;
            border: 2px solid #0a0a0f;
        }

        .badge-dev { background: #ff0000; color: white; }
        .badge-admin { background: #8b5cf6; color: white; }
        .badge-user { background: #ff00aa; color: white; }

        .telegram-badge {
            background: #0088cc;
            color: white;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 14px;
            margin-left: 10px;
        }

        .youtube-badge {
            background: #ff0000;
            color: white;
            padding: 5px 15px;
            border-radius: 30px;
            font-size: 14px;
            margin-left: 10px;
        }

        .balances {
            display: flex;
            gap: 25px;
            background: rgba(18, 10, 26, 0.9);
            padding: 15px 40px;
            border-radius: 60px;
            border: 2px solid #8b5cf6;
        }

        .balance-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .balance-value {
            font-size: 28px;
            font-weight: 700;
            font-family: 'Roboto Mono', monospace;
        }

        .usd .balance-value { color: #8b5cf6; }
        .crystal .balance-value { color: #ff00aa; }

        .toxic-tabs {
            display: flex;
            gap: 15px;
            margin-bottom: 30px;
            flex-wrap: wrap;
        }

        .toxic-tab {
            padding: 18px 35px;
            background: rgba(18, 10, 26, 0.9);
            border: 2px solid #8b5cf6;
            border-radius: 50px;
            color: #e0b3ff;
            font-weight: 600;
            font-size: 18px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toxic-tab:hover {
            background: #8b5cf6;
            color: #0a0a0f;
        }

        .toxic-tab.active {
            background: #8b5cf6;
            color: #0a0a0f;
        }

        .click-button {
            width: 350px;
            height: 350px;
            border-radius: 50%;
            background: radial-gradient(circle at 30% 30%, #8b5cf6, #ff00aa);
            border: 4px solid #e0b3ff;
            box-shadow: 0 0 100px #8b5cf6;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            font-weight: 800;
            color: #0a0a0f;
            transition: all 0.1s;
            margin: 0 auto 20px;
        }

        .click-button:active {
            transform: scale(0.95);
        }

        .toxic-btn {
            background: rgba(139, 92, 246, 0.2);
            border: 2px solid #8b5cf6;
            color: #e0b3ff;
            padding: 15px 30px;
            border-radius: 50px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toxic-btn:hover {
            background: #8b5cf6;
            color: #0a0a0f;
        }

        .toxic-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .toxic-card {
            background: rgba(18, 10, 26, 0.7);
            border: 2px solid #8b5cf6;
            border-radius: 25px;
            padding: 20px;
            margin-bottom: 15px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .toxic-card:hover {
            transform: translateX(10px);
        }

        .game-card {
            background: rgba(139, 92, 246, 0.1);
            border: 2px solid #ff00aa;
            border-radius: 25px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
        }

        .friend-online {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #00ff00;
            display: inline-block;
            margin-right: 10px;
        }

        .friend-offline {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #6b7280;
            display: inline-block;
            margin-right: 10px;
        }

        .admin-panel-dev {
            border: 3px solid #ff0000;
            border-radius: 30px;
            padding: 30px;
            margin-top: 30px;
            background: linear-gradient(145deg, #1a0f1a, #0a0a0f);
        }

        .admin-panel-admin {
            border: 3px solid #8b5cf6;
            border-radius: 30px;
            padding: 30px;
            margin-top: 30px;
            background: linear-gradient(145deg, #1a0f2a, #0a0a0f);
        }

        .admin-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .admin-btn-dev {
            background: #2a1a2a;
            border: 2px solid #ff0000;
            color: white;
            padding: 15px;
            border-radius: 25px;
            cursor: pointer;
        }

        .admin-btn-admin {
            background: #1a1a2a;
            border: 2px solid #8b5cf6;
            color: white;
            padding: 15px;
            border-radius: 25px;
            cursor: pointer;
        }

        .input-field {
            background: rgba(18, 10, 26, 0.9);
            border: 2px solid #8b5cf6;
            border-radius: 30px;
            padding: 18px 25px;
            color: #e0b3ff;
            font-size: 16px;
            width: 100%;
            margin-bottom: 15px;
        }

        .input-field:focus {
            outline: none;
            border-color: #ff00aa;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            backdrop-filter: blur(8px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            max-width: 600px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .chat-container {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
            height: 500px;
        }

        .chat-sidebar {
            background: rgba(18, 10, 26, 0.9);
            border: 2px solid #8b5cf6;
            border-radius: 25px;
            padding: 15px;
            overflow-y: auto;
        }

        .chat-main {
            background: rgba(18, 10, 26, 0.9);
            border: 2px solid #8b5cf6;
            border-radius: 25px;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .chat-message {
            padding: 10px 15px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 20px;
            margin-bottom: 10px;
            cursor: pointer;
        }

        .chat-message.own {
            align-self: flex-end;
            background: rgba(139, 92, 246, 0.3);
        }

        .chat-input-area {
            padding: 20px;
            border-top: 2px solid #8b5cf6;
            display: flex;
            gap: 10px;
        }

        .chat-input {
            flex: 1;
            background: rgba(18, 10, 26, 0.9);
            border: 2px solid #8b5cf6;
            border-radius: 25px;
            padding: 12px 20px;
            color: #e0b3ff;
        }

        .chat-tab {
            padding: 10px 15px;
            background: rgba(139, 92, 246, 0.1);
            border: 1px solid #8b5cf6;
            border-radius: 20px;
            cursor: pointer;
            margin-bottom: 10px;
        }

        .chat-tab.active {
            background: #8b5cf6;
            color: #0a0a0f;
        }

        .online-count {
            background: #00ff00;
            color: #0a0a0f;
            padding: 2px 8px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }

        .floating-number {
            position: fixed;
            color: #8b5cf6;
            font-size: 28px;
            font-weight: 800;
            pointer-events: none;
            animation: floatUp 1.5s ease-out forwards;
            z-index: 10001;
        }

        @keyframes floatUp {
            0% { transform: translateY(0); opacity: 1; }
            100% { transform: translateY(-150px); opacity: 0; }
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: rgba(18, 10, 26, 0.95);
            border-left: 6px solid #8b5cf6;
            color: #e0b3ff;
            padding: 20px 30px;
            border-radius: 30px;
            z-index: 10002;
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .stat-card {
            background: rgba(18, 10, 26, 0.7);
            border: 2px solid #8b5cf6;
            border-radius: 25px;
            padding: 20px;
            text-align: center;
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #8b5cf6;
        }

        .crypto-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 10px;
            background: rgba(139, 92, 246, 0.2);
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #8b5cf6, #ff00aa);
            border-radius: 10px;
        }

        .rank-badge {
            display: inline-block;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 5px;
        }

        .rank-1 { background: gold; color: black; }
        .rank-2 { background: silver; color: black; }
        .rank-3 { background: #cd7f32; color: black; }
    </style>
</head>
<body>
    <div class="app" id="app"></div>

    <script>
        // ==================== –ì–õ–û–ë–ê–õ–¨–ù–´–ï –î–ê–ù–ù–´–ï ====================
        let currentUser = null;
        let users = [];
        let clans = [];
        let messages = { global: [], clan: {} };
        let auctions = [];
        let businesses = [];
        let pvpBattles = [];
        let currentChat = 'global';
        let currentTab = 'mine';
        let showAdminPanel = false;
        let viewingProfile = null;
        
        let cryptoRates = { BTC: 45000, ETH: 2800, SOL: 110, DOGE: 0.12 };

        const miners = [
            { id: 'cpu', name: 'üñ•Ô∏è CPU –ú–∞–π–Ω–µ—Ä', price: 100, income: 1, emoji: 'üíª' },
            { id: 'gpu', name: 'üéÆ GPU –ú–∞–π–Ω–µ—Ä', price: 500, income: 5, emoji: 'üñ•Ô∏è' },
            { id: 'asic', name: '‚ö° ASIC –ú–∞–π–Ω–µ—Ä', price: 2500, income: 25, emoji: 'üè≠' },
            { id: 'farm', name: 'üè≠ –ú–∞–π–Ω–∏–Ω–≥ —Ñ–µ—Ä–º–∞', price: 10000, income: 100, emoji: '‚öôÔ∏è' },
            { id: 'quantum', name: 'üîÆ Quantum', price: 50000, income: 500, emoji: 'üíé' }
        ];

        const nfts = [
            { id: 'nft1', name: 'Crypto Punk', bonus: 0.01, emoji: 'üë§' },
            { id: 'nft2', name: 'Bored Ape', bonus: 0.03, emoji: 'üêí' },
            { id: 'nft3', name: 'Cyber Cat', bonus: 0.05, emoji: 'üê±' },
            { id: 'nft4', name: 'Digital God', bonus: 0.10, emoji: 'üëë' },
            { id: 'nft5', name: 'Mystic Alien', bonus: 0.15, emoji: 'üëΩ' }
        ];

        let vipPrices = { 1: 1000, 3: 2500, 6: 4500, 12: 8000 };

        const clanUpgradePrices = {
            2: 2000,
            3: 5000,
            4: 10000,
            5: 20000,
            6: 40000,
            7: 80000,
            8: 150000,
            9: 300000,
            10: 500000
        };

        const businessUpgradePrices = {
            2: 1000,
            3: 2500,
            4: 5000,
            5: 10000,
            6: 20000,
            7: 40000,
            8: 80000,
            9: 150000,
            10: 300000
        };

        const achievements = [
            { id: 'first_click', name: '–ü–µ—Ä–≤—ã–π —à–∞–≥', icon: 'üëÜ', reward: 10 },
            { id: 'first_miner', name: '–ù–∞—á–∏–Ω–∞—é—â–∏–π –º–∞–π–Ω–µ—Ä', icon: '‚õèÔ∏è', reward: 50 },
            { id: 'first_friend', name: '–î—Ä—É–∂–µ–ª—é–±–Ω—ã–π', icon: 'üë•', reward: 20 },
            { id: 'first_crypto', name: '–ö—Ä–∏–ø—Ç–æ-–∏–Ω–≤–µ—Å—Ç–æ—Ä', icon: 'üìà', reward: 30 },
            { id: 'first_clan', name: '–õ–∏–¥–µ—Ä', icon: '‚öîÔ∏è', reward: 100 },
            { id: 'first_business', name: '–ë–∏–∑–Ω–µ—Å–º–µ–Ω', icon: 'üè¢', reward: 200 },
            { id: 'first_auction', name: '–¢–æ—Ä–≥–æ–≤–µ—Ü', icon: 'üè™', reward: 150 },
            { id: 'first_pvp', name: '–í–æ–∏–Ω', icon: 'üî´', reward: 300 },
            { id: 'millionaire', name: '–ú–∏–ª–ª–∏–æ–Ω–µ—Ä', icon: 'üí∞', reward: 500 },
            { id: 'vip_member', name: 'VIP', icon: 'üëë', reward: 200 },
            { id: 'collector', name: '–ö–æ–ª–ª–µ–∫—Ü–∏–æ–Ω–µ—Ä', icon: 'üíé', reward: 1000 }
        ];

        // ==================== –ë–õ–û–ö–ò–†–û–í–ö–ê –ö–ù–û–ü–û–ö ====================
        let buttonLocked = {
            login: false,
            register: false
        };

        function lockButton(type) {
            buttonLocked[type] = true;
            const btn = document.getElementById(type === 'login' ? 'loginBtn' : 'registerBtn');
            if (btn) btn.disabled = true;
            setTimeout(() => {
                buttonLocked[type] = false;
                if (btn) btn.disabled = false;
            }, 1000);
        }

        // ==================== –£–¢–ò–õ–ò–¢–´ ====================
        function showToast(msg, isError = false) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.style.borderLeftColor = isError ? '#ff6b6b' : '#8b5cf6';
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        function formatMoney(n) {
            if (n === undefined || n === null || isNaN(n)) return '0.00';
            return n.toFixed(2).replace(/\d(?=(\d{3})+\.)/g, '$&,');
        }

        function createFloatingNumber(x, y, text) {
            const el = document.createElement('div');
            el.className = 'floating-number';
            el.textContent = text;
            el.style.left = x + 'px';
            el.style.top = y + 'px';
            document.body.appendChild(el);
            setTimeout(() => el.remove(), 1500);
        }

        function getUserRole(user) {
            if (!user) return 'USER';
            if (user.id === 'user_177') return 'DEV';
            return user.role || 'USER';
        }

        function getUserClan(userId) {
            if (!userId) return null;
            return clans.find(c => c.members?.some(m => m.userId === userId));
        }

        function getClanRank(userId) {
            const clan = getUserClan(userId);
            if (!clan) return null;
            const member = clan.members.find(m => m.userId === userId);
            return member ? member.rank : null;
        }

        function getUserBusiness(userId) {
            if (!userId) return null;
            return businesses.find(b => b.ownerId === userId || b.employees?.some(e => e.userId === userId));
        }

        function getTotalBonus(user) {
            if (!user) return 1;
            let bonus = 1;
            if (user.nfts) user.nfts.forEach(n => { if (n?.bonus) bonus += n.bonus; });
            const clan = getUserClan(user.id);
            if (clan?.clanBonus) bonus *= clan.clanBonus;
            if (user.vip?.active && user.vip.expiresAt > Date.now()) bonus *= 1.5;
            return bonus;
        }

        function getTimeLeft(expiresAt) {
            const diff = expiresAt - Date.now();
            if (diff <= 0) return '–ò—Å—Ç–µ–∫';
            const days = Math.floor(diff / (24 * 60 * 60 * 1000));
            const hours = Math.floor((diff % (24 * 60 * 60 * 1000)) / (60 * 60 * 1000));
            return `${days}–¥ ${hours}—á`;
        }

        function getOnlineCount() {
            return users.filter(u => u.online && Date.now() - u.lastSeen < 60000).length;
        }

        // ==================== –°–û–•–†–ê–ù–ï–ù–ò–ï –° –ü–†–û–í–ï–†–ö–û–ô ====================
        function saveAll() {
            try {
                localStorage.setItem('cryptoBankUsers', JSON.stringify(users));
                localStorage.setItem('cryptoBankClans', JSON.stringify(clans));
                localStorage.setItem('cryptoBankMessages', JSON.stringify(messages));
                localStorage.setItem('cryptoBankAuctions', JSON.stringify(auctions));
                localStorage.setItem('cryptoBankBusinesses', JSON.stringify(businesses));
                localStorage.setItem('cryptoBankPvp', JSON.stringify(pvpBattles));
                if (currentUser) localStorage.setItem('cryptoBankSession', JSON.stringify(currentUser));
            } catch (e) {
                console.log('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
            }
        }

        // ==================== –ó–ê–ì–†–£–ó–ö–ê –° –í–ê–õ–ò–î–ê–¶–ò–ï–ô ====================
        function safeJSONParse(str, defaultValue) {
            try {
                return JSON.parse(str) || defaultValue;
            } catch {
                return defaultValue;
            }
        }

        function loadData() {
            users = safeJSONParse(localStorage.getItem('cryptoBankUsers'), []);
            clans = safeJSONParse(localStorage.getItem('cryptoBankClans'), []);
            messages = safeJSONParse(localStorage.getItem('cryptoBankMessages'), { global: [], clan: {} });
            auctions = safeJSONParse(localStorage.getItem('cryptoBankAuctions'), []);
            businesses = safeJSONParse(localStorage.getItem('cryptoBankBusinesses'), []);
            pvpBattles = safeJSONParse(localStorage.getItem('cryptoBankPvp'), []);
            
            if (!users.find(u => u?.id === 'user_177')) {
                users.push({
                    id: 'user_177',
                    login: 'exeosinter',
                    password: 'admin',
                    name: 'exeosinter',
                    telegram: '@mwn1w',
                    youtube: '@mwn1w',
                    role: 'DEV',
                    balanceUsd: 999999999,
                    balanceCrystal: 999999,
                    cardNumber: 'LEAD-177',
                    totalClicks: 0,
                    clickMultiplier: 1,
                    autoClicker: true,
                    miners: miners.map(m => ({ id: m.id })),
                    nfts: nfts.map(n => ({ ...n })),
                    cryptoPortfolio: { BTC: 100, ETH: 1000, SOL: 5000, DOGE: 100000 },
                    friends: [],
                    friendRequests: [],
                    online: true,
                    lastSeen: Date.now(),
                    vip: { active: true, expiresAt: Date.now() + 30 * 24 * 60 * 60 * 1000 },
                    warnings: 0,
                    muted: false,
                    achievements: achievements.map(a => a.id),
                    transactions: [],
                    games: { roulette: 0, dice: 0, double: 0 },
                    pvpWins: 0,
                    pvpLosses: 0
                });
            }
            
            const session = safeJSONParse(localStorage.getItem('cryptoBankSession'), null);
            if (session?.id) {
                currentUser = users.find(u => u.id === session.id) || session;
            }
        }

        // ==================== –û–ß–ò–°–¢–ö–ê –î–ê–ù–ù–´–• ====================
        function clearAllData() {
            if (confirm('–í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã! –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                localStorage.clear();
                location.reload();
            }
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –í–•–û–î–ê (–° –ü–†–û–í–ï–†–ö–ê–ú–ò) ====================
        function showLoginForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabLogin = document.getElementById('tabLogin');
            const tabRegister = document.getElementById('tabRegister');
            
            if (loginForm) loginForm.style.display = 'block';
            if (registerForm) registerForm.style.display = 'none';
            if (tabLogin) tabLogin.classList.add('active');
            if (tabRegister) tabRegister.classList.remove('active');
        }

        function showRegisterForm() {
            const loginForm = document.getElementById('loginForm');
            const registerForm = document.getElementById('registerForm');
            const tabLogin = document.getElementById('tabLogin');
            const tabRegister = document.getElementById('tabRegister');
            
            if (registerForm) registerForm.style.display = 'block';
            if (loginForm) loginForm.style.display = 'none';
            if (tabRegister) tabRegister.classList.add('active');
            if (tabLogin) tabLogin.classList.remove('active');
        }

        function handleLogin() {
            if (buttonLocked.login) {
                showToast('–ü–æ–¥–æ–∂–¥–∏—Ç–µ —Å–µ–∫—É–Ω–¥—É...', true);
                return;
            }
            
            const loginInput = document.getElementById('loginLogin');
            const passInput = document.getElementById('loginPass');
            
            if (!loginInput || !passInput) {
                showToast('–û—à–∏–±–∫–∞: –ø–æ–ª—è –≤–≤–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', true);
                return;
            }
            
            const login = loginInput.value;
            const pass = passInput.value;
            
            if (!login || !pass) {
                showToast('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω –∏ –ø–∞—Ä–æ–ª—å', true);
                if (loginInput) loginInput.classList.add('error');
                if (passInput) passInput.classList.add('error');
                setTimeout(() => {
                    if (loginInput) loginInput.classList.remove('error');
                    if (passInput) passInput.classList.remove('error');
                }, 1000);
                return;
            }
            
            lockButton('login');
            
            const user = users.find(u => u.login === login && u.password === pass);
            if (user) {
                currentUser = user;
                currentUser.online = true;
                currentUser.lastSeen = Date.now();
                saveAll();
                showToast(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${user.name}!`);
                render();
            } else {
                showToast('–ù–µ–≤–µ—Ä–Ω—ã–π –ª–æ–≥–∏–Ω –∏–ª–∏ –ø–∞—Ä–æ–ª—å', true);
            }
        }

        function handleRegister() {
            if (buttonLocked.register) {
                showToast('–ü–æ–¥–æ–∂–¥–∏—Ç–µ —Å–µ–∫—É–Ω–¥—É...', true);
                return;
            }
            
            const loginInput = document.getElementById('regLogin');
            const passInput = document.getElementById('regPass');
            const nameInput = document.getElementById('regName');
            
            if (!loginInput || !passInput || !nameInput) {
                showToast('–û—à–∏–±–∫–∞: –ø–æ–ª—è –≤–≤–æ–¥–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã', true);
                return;
            }
            
            const login = loginInput.value;
            const pass = passInput.value;
            const name = nameInput.value;
            
            if (!login || !pass || !name) {
                showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è', true);
                if (!login) loginInput.classList.add('error');
                if (!pass) passInput.classList.add('error');
                if (!name) nameInput.classList.add('error');
                setTimeout(() => {
                    loginInput.classList.remove('error');
                    passInput.classList.remove('error');
                    nameInput.classList.remove('error');
                }, 1000);
                return;
            }
            
            if (login.length < 3) {
                showToast('–õ–æ–≥–∏–Ω –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞', true);
                loginInput.classList.add('error');
                setTimeout(() => loginInput.classList.remove('error'), 1000);
                return;
            }
            
            if (pass.length < 3) {
                showToast('–ü–∞—Ä–æ–ª—å –º–∏–Ω–∏–º—É–º 3 —Å–∏–º–≤–æ–ª–∞', true);
                passInput.classList.add('error');
                setTimeout(() => passInput.classList.remove('error'), 1000);
                return;
            }
            
            if (users.find(u => u.login === login)) {
                showToast('–õ–æ–≥–∏–Ω —É–∂–µ –∑–∞–Ω—è—Ç', true);
                loginInput.classList.add('error');
                setTimeout(() => loginInput.classList.remove('error'), 1000);
                return;
            }
            
            lockButton('register');
            
            const newUser = {
                id: 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9),
                login: login,
                password: pass,
                name: name,
                role: 'USER',
                balanceUsd: 100,
                balanceCrystal: 50,
                cardNumber: '**** **** **** ' + Math.floor(1000 + Math.random()*9000),
                totalClicks: 0,
                clickMultiplier: 1,
                autoClicker: false,
                miners: [], 
                nfts: [], 
                friends: [], 
                friendRequests: [],
                cryptoPortfolio: { BTC:0, ETH:0, SOL:0, DOGE:0 },
                online: true,
                lastSeen: Date.now(),
                warnings: 0,
                muted: false,
                achievements: [],
                transactions: [],
                games: { roulette: 0, dice: 0, double: 0 },
                pvpWins: 0,
                pvpLosses: 0
            };
            
            users.push(newUser);
            currentUser = newUser;
            saveAll();
            showToast(`‚úÖ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${name}!`);
            render();
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ù–ê–í–ò–ì–ê–¶–ò–ò ====================
        function switchTab(tab) {
            currentTab = tab;
            viewingProfile = null;
            render();
        }

        function toggleAdminPanel() {
            showAdminPanel = !showAdminPanel;
            render();
        }

        function switchChat(chat) {
            currentChat = chat;
            render();
        }

        function viewProfile(userId) {
            const user = users.find(u => u.id === userId);
            if (user) {
                viewingProfile = user;
                render();
            }
        }

        function closeProfile() {
            viewingProfile = null;
            render();
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ò–ì–†–´ ====================
        function handleClick(e) {
            const bonus = getTotalBonus(currentUser);
            const earned = 1 * (bonus || 1);
            currentUser.balanceUsd += earned;
            currentUser.totalClicks++;
            createFloatingNumber(e.clientX, e.clientY, `+$${earned.toFixed(2)}`);
            if (Math.random() < 0.05) {
                currentUser.balanceCrystal++;
                showToast('üíé +1 –∫—Ä–∏—Å—Ç–∞–ª–ª!');
            }
            saveAll();
            render();
        }

        function buyCrypto(coin, amount) {
            if (!currentUser) return;
            const price = cryptoRates[coin] * amount;
            if (currentUser.balanceUsd >= price) {
                currentUser.balanceUsd -= price;
                if (!currentUser.cryptoPortfolio) currentUser.cryptoPortfolio = { BTC:0, ETH:0, SOL:0, DOGE:0 };
                currentUser.cryptoPortfolio[coin] = (currentUser.cryptoPortfolio[coin] || 0) + amount;
                saveAll(); render(); showToast(`‚úÖ –ö—É–ø–ª–µ–Ω–æ ${amount} ${coin}`);
            } else showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true);
        }

        function sellCrypto(coin, amount) {
            if (!currentUser) return;
            if ((currentUser.cryptoPortfolio?.[coin] || 0) < amount) {
                showToast('‚ùå –ù–µ—Ç –º–æ–Ω–µ—Ç', true); return;
            }
            const price = cryptoRates[coin] * amount;
            currentUser.balanceUsd += price;
            currentUser.cryptoPortfolio[coin] -= amount;
            saveAll(); render(); showToast(`‚úÖ –ü—Ä–æ–¥–∞–Ω–æ –∑–∞ $${price.toFixed(2)}`);
        }

        function buyMiner(minerId) {
            if (!currentUser) return;
            const miner = miners.find(m => m.id === minerId);
            if (currentUser.miners?.some(m => m.id === minerId)) {
                showToast('–£–∂–µ –∫—É–ø–ª–µ–Ω–æ', true); return;
            }
            if (currentUser.balanceUsd >= miner.price) {
                if (!currentUser.miners) currentUser.miners = [];
                currentUser.balanceUsd -= miner.price;
                currentUser.miners.push({ id: minerId });
                saveAll(); render(); showToast(`‚úÖ –ö—É–ø–ª–µ–Ω ${miner.name}`);
            } else showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true);
        }

        function buyVip(months) {
            if (!currentUser) return;
            const price = vipPrices[months];
            if (currentUser.balanceCrystal < price) {
                showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return;
            }
            currentUser.balanceCrystal -= price;
            currentUser.vip = { active: true, expiresAt: Date.now() + months * 30 * 24 * 60 * 60 * 1000 };
            saveAll(); render(); showToast(`‚úÖ VIP –Ω–∞ ${months} –º–µ—Å`);
        }

        function editContacts() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">üì± –ö–û–ù–¢–ê–ö–¢–´</h3>
                        <input type="text" id="editTelegram" class="input-field" placeholder="Telegram" value="${currentUser.telegram || ''}">
                        <input type="text" id="editYoutube" class="input-field" placeholder="YouTube" value="${currentUser.youtube || ''}">
                        <button class="toxic-btn" onclick="saveContacts()">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function saveContacts() {
            const telegram = document.getElementById('editTelegram')?.value;
            const youtube = document.getElementById('editYoutube')?.value;
            if (telegram !== undefined) currentUser.telegram = telegram || null;
            if (youtube !== undefined) currentUser.youtube = youtube || null;
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
            showToast('‚úÖ –ö–æ–Ω—Ç–∞–∫—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã');
        }

        function showTransferModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">üí∏ –ü–ï–†–ï–í–û–î</h3>
                        <input type="text" id="transferLogin" class="input-field" placeholder="–õ–æ–≥–∏–Ω –ø–æ–ª—É—á–∞—Ç–µ–ª—è">
                        <input type="number" id="transferAmount" class="input-field" placeholder="–°—É–º–º–∞ $" min="0">
                        <input type="number" id="transferCrystals" class="input-field" placeholder="–ö—Ä–∏—Å—Ç–∞–ª–ª—ã üíé" min="0">
                        <button class="toxic-btn" onclick="confirmTransfer()">–ü–µ—Ä–µ–≤–µ—Å—Ç–∏</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmTransfer() {
            const login = document.getElementById('transferLogin')?.value;
            const amount = parseFloat(document.getElementById('transferAmount')?.value) || 0;
            const crystals = parseInt(document.getElementById('transferCrystals')?.value) || 0;
            
            if (!login) { showToast('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω', true); return; }
            if (amount <= 0 && crystals <= 0) { showToast('–í–≤–µ–¥–∏—Ç–µ —Å—É–º–º—É', true); return; }
            
            const recipient = users.find(u => u.login === login);
            if (!recipient) { showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            if (recipient.id === currentUser.id) { showToast('–ù–µ–ª—å–∑—è –ø–µ—Ä–µ–≤–æ–¥–∏—Ç—å —Å–µ–±–µ', true); return; }
            if (amount > 0 && currentUser.balanceUsd < amount) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true); return; }
            if (crystals > 0 && currentUser.balanceCrystal < crystals) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return; }
            
            if (amount > 0) {
                currentUser.balanceUsd -= amount;
                recipient.balanceUsd += amount;
            }
            if (crystals > 0) {
                currentUser.balanceCrystal -= crystals;
                recipient.balanceCrystal += crystals;
            }
            
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
            showToast('‚úÖ –ü–µ—Ä–µ–≤–æ–¥ –≤—ã–ø–æ–ª–Ω–µ–Ω');
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –î–†–£–ó–ï–ô ====================
        function showAddFriendModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">‚ûï –î–û–ë–ê–í–ò–¢–¨ –î–†–£–ì–ê</h3>
                        <input type="text" id="friendLogin" class="input-field" placeholder="–õ–æ–≥–∏–Ω –¥—Ä—É–≥–∞">
                        <button class="toxic-btn" onclick="sendFriendRequest()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function sendFriendRequest() {
            const login = document.getElementById('friendLogin')?.value;
            if (!login) { showToast('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω', true); return; }
            
            const friend = users.find(u => u.login === login && u.id !== currentUser.id);
            if (!friend) { showToast('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            
            if (!friend.friendRequests) friend.friendRequests = [];
            if (friend.friendRequests.includes(currentUser.id)) {
                showToast('–ó–∞—è–≤–∫–∞ —É–∂–µ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞', true);
                return;
            }
            
            friend.friendRequests.push(currentUser.id);
            saveAll();
            showToast('‚úÖ –ó–∞—è–≤–∫–∞ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∞');
            document.querySelector('.modal')?.remove();
        }

        function acceptFriend(id) {
            const friend = users.find(u => u.id === id);
            if (!friend) return;
            
            if (!currentUser.friends) currentUser.friends = [];
            if (!friend.friends) friend.friends = [];
            
            currentUser.friends.push(id);
            friend.friends.push(currentUser.id);
            currentUser.friendRequests = (currentUser.friendRequests || []).filter(f => f !== id);
            
            saveAll();
            render();
            showToast('‚úÖ –î—Ä—É–≥ –¥–æ–±–∞–≤–ª–µ–Ω');
        }

        function rejectFriend(id) {
            currentUser.friendRequests = (currentUser.friendRequests || []).filter(f => f !== id);
            saveAll();
            render();
            showToast('‚ùå –ó–∞—è–≤–∫–∞ –æ—Ç–∫–ª–æ–Ω–µ–Ω–∞');
        }

        function giftFriend(id) {
            const friend = users.find(u => u.id === id);
            if (!friend) return;
            
            if (currentUser.balanceCrystal >= 10) {
                currentUser.balanceCrystal -= 10;
                friend.balanceCrystal += 10;
                saveAll();
                render();
                showToast('üíé –ü–æ–¥–∞—Ä–µ–Ω–æ 10 –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤');
            } else showToast('‚ùå –ù–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true);
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ö–õ–ê–ù–û–í ====================
        function showCreateClanModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">‚öîÔ∏è –°–û–ó–î–ê–¢–¨ –ö–õ–ê–ù</h3>
                        <input type="text" id="clanName" class="input-field" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                        <input type="text" id="clanTag" class="input-field" placeholder="–¢–µ–≥" maxlength="5">
                        <button class="toxic-btn" onclick="createClan()">–°–æ–∑–¥–∞—Ç—å (1000üíé)</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function createClan() {
            const name = document.getElementById('clanName')?.value;
            let tag = document.getElementById('clanTag')?.value?.toUpperCase();
            
            if (!name || !tag) { showToast('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –ø–æ–ª—è', true); return; }
            if (tag.length > 5) { showToast('–¢–µ–≥ –¥–æ 5 —Å–∏–º–≤–æ–ª–æ–≤', true); return; }
            if (currentUser.balanceCrystal < 1000) { showToast('‚ùå –ù–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return; }
            if (clans.find(c => c.tag === tag)) { showToast('–¢–µ–≥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è', true); return; }
            
            currentUser.balanceCrystal -= 1000;
            clans.push({
                id: 'clan_' + Date.now(),
                name: name,
                tag: tag,
                founderId: currentUser.id,
                level: 1,
                clanBonus: 1.05,
                members: [{ userId: currentUser.id, rank: 'founder' }],
                treasury: 0
            });
            
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
            showToast('‚úÖ –ö–ª–∞–Ω —Å–æ–∑–¥–∞–Ω');
        }

        function joinClan(clanId) {
            const clan = clans.find(c => c.id === clanId);
            if (!clan) return;
            clan.members.push({ userId: currentUser.id, rank: 'member' });
            saveAll();
            render();
            showToast('‚úÖ –í—ã –≤—Å—Ç—É–ø–∏–ª–∏ –≤ –∫–ª–∞–Ω');
        }

        function showChangeTagModal() {
            const clan = getUserClan(currentUser.id);
            if (!clan) return;
            
            const rank = getClanRank(currentUser.id);
            if (rank !== 'founder' && rank !== 'leader') {
                showToast('‚ùå –¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –º–æ–∂–µ—Ç –º–µ–Ω—è—Ç—å —Ç–µ–≥', true);
                return;
            }
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">‚úèÔ∏è –°–ú–ï–ù–ò–¢–¨ –¢–ï–ì</h3>
                        <input type="text" id="newTag" class="input-field" placeholder="–ù–æ–≤—ã–π —Ç–µ–≥" maxlength="5">
                        <button class="toxic-btn" onclick="changeTag()">–°–º–µ–Ω–∏—Ç—å (5000üíé)</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function changeTag() {
            const clan = getUserClan(currentUser.id);
            const newTag = document.getElementById('newTag')?.value?.toUpperCase();
            
            if (!newTag || newTag.length > 5) { showToast('–¢–µ–≥ 1-5 —Å–∏–º–≤–æ–ª–æ–≤', true); return; }
            if (clans.find(c => c.tag === newTag && c.id !== clan.id)) { showToast('–¢–µ–≥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è', true); return; }
            if (currentUser.balanceCrystal < 5000) { showToast('‚ùå –ù–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return; }
            
            currentUser.balanceCrystal -= 5000;
            clan.tag = newTag;
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
            showToast(`‚úÖ –¢–µ–≥ –∏–∑–º–µ–Ω–µ–Ω –Ω–∞ [${newTag}]`);
        }

        function upgradeClan() {
            const clan = getUserClan(currentUser.id);
            if (!clan) return;
            
            const rank = getClanRank(currentUser.id);
            if (rank !== 'founder' && rank !== 'leader') {
                showToast('‚ùå –¢–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä –º–æ–∂–µ—Ç —É–ª—É—á—à–∞—Ç—å –∫–ª–∞–Ω', true);
                return;
            }
            
            const nextLevel = clan.level + 1;
            const price = clanUpgradePrices[nextLevel];
            if (!price) { showToast('‚ùå –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å', true); return; }
            if (currentUser.balanceCrystal < price) { showToast('‚ùå –ù–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return; }
            
            currentUser.balanceCrystal -= price;
            clan.level = nextLevel;
            clan.clanBonus = 1 + (clan.level * 0.05);
            
            saveAll();
            render();
            showToast(`‚úÖ –ö–ª–∞–Ω —É–ª—É—á—à–µ–Ω –¥–æ ${nextLevel} —É—Ä–æ–≤–Ω—è`);
        }

        // ==================== –ú–ò–ù–ò-–ò–ì–†–´ ====================
        function playRoulette() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">üé∞ –†–£–õ–ï–¢–ö–ê</h3>
                        <input type="number" id="rouletteBet" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞ $" value="100">
                        <button class="toxic-btn" onclick="rouletteRed()">üî¥ –ö–†–ê–°–ù–û–ï</button>
                        <button class="toxic-btn" onclick="rouletteBlack()">‚ö´ –ß–Å–†–ù–û–ï</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function rouletteRed() {
            const bet = parseFloat(document.getElementById('rouletteBet')?.value);
            if (isNaN(bet) || bet < 10) { showToast('–ú–∏–Ω–∏–º—É–º 10$', true); return; }
            if (currentUser.balanceUsd < bet) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true); return; }
            
            const win = Math.random() < 0.5;
            currentUser.balanceUsd -= bet;
            if (win) {
                currentUser.balanceUsd += bet * 2;
                showToast(`üéâ –í–´–ò–ì–†–´–®! +$${bet}`);
            } else showToast(`üò¢ –ü–†–û–ò–ì–†–´–®`);
            
            if (!currentUser.games) currentUser.games = { roulette:0, dice:0, double:0 };
            currentUser.games.roulette++;
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
        }

        function rouletteBlack() {
            const bet = parseFloat(document.getElementById('rouletteBet')?.value);
            if (isNaN(bet) || bet < 10) { showToast('–ú–∏–Ω–∏–º—É–º 10$', true); return; }
            if (currentUser.balanceUsd < bet) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true); return; }
            
            const win = Math.random() < 0.5;
            currentUser.balanceUsd -= bet;
            if (win) {
                currentUser.balanceUsd += bet * 2;
                showToast(`üéâ –í–´–ò–ì–†–´–®! +$${bet}`);
            } else showToast(`üò¢ –ü–†–û–ò–ì–†–´–®`);
            
            if (!currentUser.games) currentUser.games = { roulette:0, dice:0, double:0 };
            currentUser.games.roulette++;
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
        }

        function playDice() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">üé≤ –ö–û–°–¢–ò</h3>
                        <input type="number" id="diceBet" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞ $" value="100">
                        <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:5px;">
                            ${[1,2,3,4,5,6].map(n => `<button class="toxic-btn" onclick="diceGuess(${n})">${n}</button>`).join('')}
                        </div>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function diceGuess(guess) {
            const bet = parseFloat(document.getElementById('diceBet')?.value);
            if (isNaN(bet) || bet < 10) { showToast('–ú–∏–Ω–∏–º—É–º 10$', true); return; }
            if (currentUser.balanceUsd < bet) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true); return; }
            
            const result = Math.floor(Math.random() * 6) + 1;
            currentUser.balanceUsd -= bet;
            if (result === guess) {
                currentUser.balanceUsd += bet * 6;
                showToast(`üéâ –í–´–ò–ì–†–´–®! –í—ã–ø–∞–ª–æ ${result}! +$${bet*5}`);
            } else showToast(`üò¢ –ü–†–û–ò–ì–†–´–®... –í—ã–ø–∞–ª–æ ${result}`);
            
            if (!currentUser.games) currentUser.games = { roulette:0, dice:0, double:0 };
            currentUser.games.dice++;
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
        }

        function playDouble() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3 style="color:#8b5cf6;">‚ö° –£–î–í–û–ï–ù–ò–ï</h3>
                        <input type="number" id="doubleBet" class="input-field" placeholder="–°—Ç–∞–≤–∫–∞ $" value="100">
                        <button class="toxic-btn" onclick="doubleGame()">üé≤ –ò–ì–†–ê–¢–¨</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function doubleGame() {
            const bet = parseFloat(document.getElementById('doubleBet')?.value);
            if (isNaN(bet) || bet < 10) { showToast('–ú–∏–Ω–∏–º—É–º 10$', true); return; }
            if (currentUser.balanceUsd < bet) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true); return; }
            
            const win = Math.random() < 0.5;
            currentUser.balanceUsd -= bet;
            if (win) {
                currentUser.balanceUsd += bet * 2;
                showToast(`üéâ –£–î–í–û–ò–õ! +$${bet}`);
            } else showToast(`üò¢ –ü–†–û–ò–ì–†–ê–õ... -$${bet}`);
            
            if (!currentUser.games) currentUser.games = { roulette:0, dice:0, double:0 };
            currentUser.games.double++;
            saveAll();
            render();
            document.querySelector('.modal')?.remove();
        }

        // ==================== –§–£–ù–ö–¶–ò–ò –ß–ê–¢–ê ====================
        function sendMessage() {
            if (!currentUser) return;
            const input = document.getElementById('chatInput');
            if (!input) return;
            
            const text = input.value.trim();
            if (!text) return;
            if (currentUser.muted) { showToast('–í—ã –∑–∞–≥–ª—É—à–µ–Ω—ã', true); return; }
            
            const message = { userId: currentUser.id, text: text, time: Date.now() };
            
            if (currentChat === 'global') {
                if (!messages.global) messages.global = [];
                messages.global.push(message);
                if (messages.global.length > 100) messages.global.shift();
            } else {
                const clan = getUserClan(currentUser.id);
                if (clan) {
                    if (!messages.clan[clan.id]) messages.clan[clan.id] = [];
                    messages.clan[clan.id].push(message);
                    if (messages.clan[clan.id].length > 100) messages.clan[clan.id].shift();
                }
            }
            
            input.value = '';
            saveAll();
            render();
        }

        // ==================== –ê–î–ú–ò–ù –§–£–ù–ö–¶–ò–ò ====================
        function adminGiveMoney() {
            const login = document.getElementById('adminUserLogin')?.value;
            const amount = parseInt(document.getElementById('adminMoneyAmount')?.value) || 1000;
            const user = users.find(u => u.login === login);
            if (user) { user.balanceUsd += amount; saveAll(); render(); showToast(`‚úÖ –í—ã–¥–∞–Ω–æ $${amount}`); }
            else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminGiveCrystals() {
            const login = document.getElementById('adminUserLogin')?.value;
            const amount = parseInt(document.getElementById('adminCrystalAmount')?.value) || 500;
            const user = users.find(u => u.login === login);
            if (user) { user.balanceCrystal += amount; saveAll(); render(); showToast(`‚úÖ –í—ã–¥–∞–Ω–æ ${amount}üíé`); }
            else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminGiveNFT() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (user) {
                if (!user.nfts) user.nfts = [];
                user.nfts.push({...nfts[Math.floor(Math.random()*nfts.length)]});
                saveAll(); render(); showToast('‚úÖ NFT –≤—ã–¥–∞–Ω–æ');
            } else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminGiveMiner() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (user) {
                if (!user.miners) user.miners = [];
                user.miners.push({ id: miners[Math.floor(Math.random()*miners.length)].id });
                saveAll(); render(); showToast('‚úÖ –ú–∞–π–Ω–µ—Ä –≤—ã–¥–∞–Ω');
            } else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminSetRole(role) {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (user && user.id !== 'user_177') {
                user.role = role; saveAll(); render(); showToast(`‚úÖ –†–æ–ª—å ${role}`);
            } else if (user?.id === 'user_177') showToast('‚ùå –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞', true);
            else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminRemoveRole() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (user && user.id !== 'user_177') {
                user.role = 'USER'; saveAll(); render(); showToast('‚úÖ –†–æ–ª—å —É–¥–∞–ª–µ–Ω–∞');
            } else if (user?.id === 'user_177') showToast('‚ùå –ù–µ–ª—å–∑—è –∏–∑–º–µ–Ω–∏—Ç—å —Ä–æ–ª—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞', true);
            else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminGiveVip() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (!user) { showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            const days = prompt('–î–Ω–µ–π:', '30');
            if (!days) return;
            user.vip = { active: true, expiresAt: Date.now() + parseInt(days) * 24 * 60 * 60 * 1000 };
            saveAll(); render(); showToast(`‚úÖ VIP –Ω–∞ ${days} –¥–Ω–µ–π`);
        }

        function adminCheckUser() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (!user) { showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            showToast(`üë§ ${user.name} | $${formatMoney(user.balanceUsd)} | üíé ${user.balanceCrystal} | ‚õèÔ∏è ${user.miners?.length || 0}`);
        }

        function adminBan() {
            const login = document.getElementById('adminUserLogin')?.value;
            const index = users.findIndex(u => u.login === login);
            if (index === -1) { showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            if (users[index].id === 'user_177') { showToast('‚ùå –ù–µ–ª—å–∑—è –∑–∞–±–∞–Ω–∏—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞', true); return; }
            users.splice(index, 1);
            saveAll(); render(); showToast('‚úÖ –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞–±–∞–Ω–µ–Ω');
        }

        function adminWarn() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (user) {
                user.warnings = (user.warnings || 0) + 1;
                saveAll(); render(); showToast(`‚ö†Ô∏è –í–∞—Ä–Ω (${user.warnings})`);
            } else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminMute() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (user) {
                user.muted = !user.muted;
                saveAll(); render(); showToast(`üîá ${user.muted ? '–ó–∞–≥–ª—É—à–µ–Ω' : '–†–∞–∑–≥–ª—É—à–µ–Ω'}`);
            } else showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true);
        }

        function adminClearChat() {
            if (currentChat === 'global') messages.global = [];
            else {
                const clan = getUserClan(currentUser.id);
                if (clan) messages.clan[clan.id] = [];
            }
            saveAll(); render(); showToast('üóëÔ∏è –ß–∞—Ç –æ—á–∏—â–µ–Ω');
        }

        function adminKick() {
            const login = document.getElementById('adminUserLogin')?.value;
            const user = users.find(u => u.login === login);
            if (!user) { showToast('‚ùå –ù–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            if (user.id === 'user_177') { showToast('‚ùå –ù–µ–ª—å–∑—è –∫–∏–∫–Ω—É—Ç—å —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–∞', true); return; }
            user.online = false;
            user.lastSeen = Date.now() - 600000;
            saveAll(); render(); showToast(`üë¢ ${user.name} –∫–∏–∫–Ω—É—Ç`);
        }

        // ==================== –ù–ê–î–ï–ñ–ù–ê–Ø –ü–†–ò–í–Ø–ó–ö–ê –°–û–ë–´–¢–ò–ô ====================
        function attachAuthEvents(retries = 0) {
            const maxRetries = 30;
            
            const tabLogin = document.getElementById('tabLogin');
            const tabRegister = document.getElementById('tabRegister');
            const loginBtn = document.getElementById('loginBtn');
            const registerBtn = document.getElementById('registerBtn');
            const loginInput = document.getElementById('loginLogin');
            const passInput = document.getElementById('loginPass');
            const regLogin = document.getElementById('regLogin');
            const regPass = document.getElementById('regPass');
            const regName = document.getElementById('regName');
            
            if (tabLogin && tabRegister && loginBtn && registerBtn && 
                loginInput && passInput && regLogin && regPass && regName) {
                
                tabLogin.onclick = showLoginForm;
                tabRegister.onclick = showRegisterForm;
                loginBtn.onclick = handleLogin;
                registerBtn.onclick = handleRegister;
                
                console.log('‚úì –í—Å–µ —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–∞–π–¥–µ–Ω—ã, —Å–æ–±—ã—Ç–∏—è –ø—Ä–∏–≤—è–∑–∞–Ω—ã');
                return true;
            }
            
            if (retries < maxRetries) {
                console.log(`–ü–æ–ø—ã—Ç–∫–∞ ${retries + 1}: –∂–¥–µ–º –∑–∞–≥—Ä—É–∑–∫–∏ DOM...`);
                setTimeout(() => attachAuthEvents(retries + 1), 100);
            } else {
                console.error('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ —ç–ª–µ–º–µ–Ω—Ç—ã –ø–æ—Å–ª–µ 30 –ø–æ–ø—ã—Ç–æ–∫');
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ù–∞–∂–º–∏—Ç–µ "–û—á–∏—Å—Ç–∏—Ç—å –¥–∞–Ω–Ω—ã–µ"', true);
            }
        }

        // ==================== –†–ï–ù–î–ï–† ====================
        function renderAuth() {
            return `
                <div class="auth-wrapper">
                    <div class="auth-glass">
                        <h1 class="auth-title">üè¶ CRYPTO BANK</h1>
                        <div class="auth-subtitle">–í–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç</div>
                        
                        <div class="auth-tabs">
                            <button class="auth-tab active" id="tabLogin">üîê –í–•–û–î</button>
                            <button class="auth-tab" id="tabRegister">üì≤ –†–ï–ì–ò–°–¢–†–ê–¶–ò–Ø</button>
                        </div>

                        <div id="loginForm" class="auth-form">
                            <div class="auth-input-group">
                                <label class="auth-label">–õ–û–ì–ò–ù</label>
                                <input type="text" id="loginLogin" class="auth-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω">
                            </div>
                            <div class="auth-input-group">
                                <label class="auth-label">–ü–ê–†–û–õ–¨</label>
                                <input type="password" id="loginPass" class="auth-input" placeholder="–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å">
                            </div>
                            <button class="auth-btn" id="loginBtn">–í–û–ô–¢–ò</button>
                        </div>

                        <div id="registerForm" class="auth-form" style="display:none;">
                            <div class="auth-input-group">
                                <label class="auth-label">–õ–û–ì–ò–ù</label>
                                <input type="text" id="regLogin" class="auth-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ª–æ–≥–∏–Ω">
                            </div>
                            <div class="auth-input-group">
                                <label class="auth-label">–ü–ê–†–û–õ–¨</label>
                                <input type="password" id="regPass" class="auth-input" placeholder="–ü—Ä–∏–¥—É–º–∞–π—Ç–µ –ø–∞—Ä–æ–ª—å">
                            </div>
                            <div class="auth-input-group">
                                <label class="auth-label">–ò–ú–Ø</label>
                                <input type="text" id="regName" class="auth-input" placeholder="–í–∞—à–µ –∏–º—è">
                            </div>
                            <button class="auth-btn" id="registerBtn">–ó–ê–†–ï–ì–ò–°–¢–†–ò–†–û–í–ê–¢–¨–°–Ø</button>
                        </div>
                        
                        <button class="danger-btn" onclick="clearAllData()">‚ö†Ô∏è –û–ß–ò–°–¢–ò–¢–¨ –í–°–ï –î–ê–ù–ù–´–ï</button>
                    </div>
                </div>
            `;
        }

        function renderProfile(user) {
            const clan = getUserClan(user.id);
            const role = getUserRole(user);
            const business = getUserBusiness(user.id);
            
            return `
                <div class="toxic-glass">
                    <div style="display:flex; justify-content:space-between;">
                        <h2 style="color:#8b5cf6;">üë§ –ü—Ä–æ—Ñ–∏–ª—å ${user.name}</h2>
                        <button class="toxic-btn" onclick="closeProfile()">‚úï</button>
                    </div>
                    
                    <div class="stats-grid">
                        <div class="stat-card"><div class="stat-value">$${formatMoney(user.balanceUsd)}</div><div>–ë–∞–ª–∞–Ω—Å</div></div>
                        <div class="stat-card"><div class="stat-value">${user.balanceCrystal} üíé</div><div>–ö—Ä–∏—Å—Ç–∞–ª–ª—ã</div></div>
                        <div class="stat-card"><div class="stat-value">${user.totalClicks || 0}</div><div>–ö–ª–∏–∫–æ–≤</div></div>
                    </div>
                    
                    ${user.telegram ? `<div>üì± Telegram: ${user.telegram}</div>` : ''}
                    ${user.youtube ? `<div>‚ñ∂Ô∏è YouTube: ${user.youtube}</div>` : ''}
                    ${clan ? `<div>‚öîÔ∏è –ö–ª–∞–Ω: ${clan.name} [${clan.tag}]</div>` : ''}
                    ${business ? `<div>üè¢ –ë–∏–∑–Ω–µ—Å: ${business.name}</div>` : ''}
                    <div>üí≥ –ö–∞—Ä—Ç–∞: ${user.cardNumber}</div>
                    <div>üì± –†–æ–ª—å: ${role}</div>
                    
                    <h3 style="color:#8b5cf6;">üíé NFT</h3>
                    <div style="display:grid; grid-template-columns:repeat(5,1fr); gap:5px;">
                        ${nfts.map(nft => {
                            const owned = user.nfts?.some(n => n.id === nft.id);
                            return `<div style="opacity:${owned ? 1 : 0.3};">${nft.emoji}</div>`;
                        }).join('')}
                    </div>
                    
                    <h3 style="color:#8b5cf6;">üèÜ –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è</h3>
                    <div style="display:grid; grid-template-columns:repeat(4,1fr); gap:5px;">
                        ${achievements.map(ach => {
                            const earned = user.achievements?.includes(ach.id);
                            return `<div style="opacity:${earned ? 1 : 0.3};">${ach.icon}</div>`;
                        }).join('')}
                    </div>
                </div>
            `;
        }

        function renderMiningTab(u, totalBonus, passiveIncome) {
            return `
                <div class="toxic-glass">
                    <h2>‚õèÔ∏è –ú–ê–ô–ù–ò–ù–ì</h2>
                    <div class="click-button" onclick="handleClick(event)">üí∞<br>–ù–ê–ñ–ú–ò</div>
                    <div style="font-size:36px;">${(1 * totalBonus).toFixed(2)} $</div>
                    <div>‚è±Ô∏è –ü–∞—Å—Å–∏–≤–Ω–æ: $${passiveIncome.toFixed(2)}/—Å–µ–∫</div>
                    
                    <h3>‚öôÔ∏è –ú–ê–ô–ù–ï–†–´</h3>
                    ${miners.map(miner => {
                        const owned = u.miners?.some(m => m.id === miner.id);
                        return `
                            <div class="toxic-card" onclick="buyMiner('${miner.id}')">
                                <span>${miner.emoji} ${miner.name}</span>
                                <span style="color:${owned ? '#0f0' : '#ff0'};">${owned ? '‚úì' : `$${miner.price}`}</span>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function renderCryptoTab(u) {
            const total = Object.entries(u.cryptoPortfolio || {}).reduce((s, [c, a]) => s + a * cryptoRates[c], 0);
            return `
                <div class="toxic-glass">
                    <h2>üìà –ö–†–ò–ü–¢–û</h2>
                    <div>üí∞ –ü–æ—Ä—Ç—Ñ–µ–ª—å: $${formatMoney(total)}</div>
                    ${Object.entries(cryptoRates).map(([coin, price]) => `
                        <div class="toxic-card">
                            <div>${coin} $${price.toFixed(2)}</div>
                            <div>–í –ø–æ—Ä—Ç—Ñ–µ–ª–µ: ${u.cryptoPortfolio?.[coin] || 0}</div>
                            <button class="toxic-btn" onclick="buyCrypto('${coin}',1)">+1</button>
                            <button class="toxic-btn" onclick="sellCrypto('${coin}',1)">-1</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderGamesTab() {
            return `
                <div class="toxic-glass">
                    <h2>üé≤ –ò–ì–†–´</h2>
                    <div style="display:grid; grid-template-columns:repeat(3,1fr); gap:10px;">
                        <div class="game-card" onclick="playRoulette()">üé∞ –†–£–õ–ï–¢–ö–ê</div>
                        <div class="game-card" onclick="playDice()">üé≤ –ö–û–°–¢–ò</div>
                        <div class="game-card" onclick="playDouble()">‚ö° –£–î–í–û–ï–ù–ò–ï</div>
                    </div>
                </div>
            `;
        }

        function renderAuctionTab() {
            const activeAuctions = auctions.filter(a => a.active);
            return `
                <div class="toxic-glass">
                    <h2>üè™ –ê–£–ö–¶–ò–û–ù</h2>
                    <button class="toxic-btn" onclick="showAuctionModal()">üì§ –ú–û–ò NFT</button>
                    <h3>üè∑Ô∏è –õ–û–¢–´</h3>
                    ${activeAuctions.map(auction => {
                        const seller = users.find(u => u.id === auction.sellerId);
                        return `
                            <div class="toxic-card">
                                <div>${auction.nft.emoji} ${auction.nft.name}</div>
                                <div>${auction.price} üíé</div>
                                <div>–ü—Ä–æ–¥–∞–≤–µ—Ü: ${seller?.name}</div>
                                <button class="toxic-btn" onclick="buyNft('${auction.id}')">–ö—É–ø–∏—Ç—å</button>
                            </div>
                        `;
                    }).join('')}
                </div>
            `;
        }

        function showAuctionModal() {
            const userNfts = currentUser.nfts || [];
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3>üì§ –ú–û–ò NFT</h3>
                        ${userNfts.map((nft, index) => `
                            <div class="game-card" onclick="sellNft(${index})">
                                ${nft.emoji} ${nft.name} +${nft.bonus*100}%
                            </div>
                        `).join('')}
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function sellNft(index) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3>üí∞ –¶–ï–ù–ê</h3>
                        <input type="number" id="nftPrice" class="input-field" placeholder="–¶–µ–Ω–∞ –≤ üíé" min="1">
                        <button class="toxic-btn" onclick="confirmSell(${index})">–ü—Ä–æ–¥–∞—Ç—å</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function confirmSell(index) {
            const price = parseInt(document.getElementById('nftPrice')?.value);
            if (isNaN(price) || price < 1) { showToast('–í–≤–µ–¥–∏—Ç–µ —Ü–µ–Ω—É', true); return; }
            
            const nft = currentUser.nfts[index];
            auctions.push({
                id: 'auction_' + Date.now(),
                sellerId: currentUser.id,
                nft: nft,
                price: price,
                active: true,
                time: Date.now()
            });
            currentUser.nfts.splice(index, 1);
            saveAll(); render(); 
            document.querySelector('.modal')?.remove();
            showToast('‚úÖ NFT –≤—ã—Å—Ç–∞–≤–ª–µ–Ω');
        }

        function buyNft(auctionId) {
            const auction = auctions.find(a => a.id === auctionId);
            if (currentUser.balanceCrystal < auction.price) {
                showToast('‚ùå –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true);
                return;
            }
            
            currentUser.balanceCrystal -= auction.price;
            currentUser.nfts.push({...auction.nft});
            const seller = users.find(u => u.id === auction.sellerId);
            if (seller) seller.balanceCrystal += auction.price;
            auctions = auctions.filter(a => a.id !== auctionId);
            saveAll(); render(); showToast('‚úÖ NFT –∫—É–ø–ª–µ–Ω');
        }

        function renderBusinessTab(u, userBusiness) {
            if (!userBusiness) {
                return `
                    <div class="toxic-glass">
                        <h2>üè¢ –ë–ò–ó–ù–ï–°</h2>
                        <button class="toxic-btn" onclick="showCreateBusinessModal()">‚ú® –°–û–ó–î–ê–¢–¨ (5000üíé)</button>
                    </div>
                `;
            }
            
            return `
                <div class="toxic-glass">
                    <h2>üè¢ ${userBusiness.name}</h2>
                    <div>–£—Ä–æ–≤–µ–Ω—å: ${userBusiness.level}</div>
                    <div>–î–æ—Ö–æ–¥: $${userBusiness.income}/—Å–µ–∫</div>
                    <div>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${userBusiness.employees.length}</div>
                    <button class="toxic-btn" onclick="showBusinessModal('${userBusiness.id}')">‚öôÔ∏è –£–ü–†–ê–í–õ–Ø–¢–¨</button>
                </div>
            `;
        }

        function showCreateBusinessModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3>üè¢ –°–û–ó–î–ê–¢–¨ –ë–ò–ó–ù–ï–°</h3>
                        <input type="text" id="businessName" class="input-field" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ">
                        <button class="toxic-btn" onclick="createBusiness()">–°–æ–∑–¥–∞—Ç—å (5000üíé)</button>
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–û—Ç–º–µ–Ω–∞</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function createBusiness() {
            const name = document.getElementById('businessName')?.value;
            if (!name) { showToast('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ', true); return; }
            if (currentUser.balanceCrystal < 5000) { showToast('‚ùå –ù–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return; }
            
            currentUser.balanceCrystal -= 5000;
            businesses.push({
                id: 'business_' + Date.now(),
                name: name,
                ownerId: currentUser.id,
                level: 1,
                income: 10,
                employees: [{ userId: currentUser.id, role: 'owner' }],
                treasury: 0
            });
            saveAll(); render(); 
            document.querySelector('.modal')?.remove();
            showToast('‚úÖ –ë–∏–∑–Ω–µ—Å —Å–æ–∑–¥–∞–Ω');
        }

        function showBusinessModal(businessId) {
            const business = businesses.find(b => b.id === businessId);
            const isOwner = business.ownerId === currentUser.id;
            const nextLevelPrice = businessUpgradePrices[business.level + 1];
            
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3>üè¢ ${business.name}</h3>
                        <div>–£—Ä–æ–≤–µ–Ω—å: ${business.level}</div>
                        <div>–î–æ—Ö–æ–¥: $${business.income}/—Å–µ–∫</div>
                        <div>–°–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤: ${business.employees.length}</div>
                        
                        ${isOwner ? `
                            ${nextLevelPrice ? `<button class="toxic-btn" onclick="upgradeBusiness('${business.id}')">‚¨ÜÔ∏è –£–ª—É—á—à–∏—Ç—å (${nextLevelPrice}üíé)</button>` : ''}
                            <input type="text" id="hireLogin" class="input-field" placeholder="–õ–æ–≥–∏–Ω —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–∞">
                            <button class="toxic-btn" onclick="hireEmployee('${business.id}')">‚ûï –ù–∞–Ω—è—Ç—å</button>
                        ` : ''}
                        
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function upgradeBusiness(businessId) {
            const business = businesses.find(b => b.id === businessId);
            const nextLevel = business.level + 1;
            const price = businessUpgradePrices[nextLevel];
            if (!price) { showToast('‚ùå –ú–∞–∫—Å. —É—Ä–æ–≤–µ–Ω—å', true); return; }
            if (currentUser.balanceCrystal < price) { showToast('‚ùå –ù–µ—Ç –∫—Ä–∏—Å—Ç–∞–ª–ª–æ–≤', true); return; }
            
            currentUser.balanceCrystal -= price;
            business.level = nextLevel;
            business.income = 10 * nextLevel;
            saveAll(); render(); 
            document.querySelector('.modal')?.remove();
            showToast(`‚úÖ –£–ª—É—á—à–µ–Ω –¥–æ ${nextLevel} —É—Ä–æ–≤–Ω—è`);
        }

        function hireEmployee(businessId) {
            const business = businesses.find(b => b.id === businessId);
            const login = document.getElementById('hireLogin')?.value;
            if (!login) { showToast('–í–≤–µ–¥–∏—Ç–µ –ª–æ–≥–∏–Ω', true); return; }
            
            const employee = users.find(u => u.login === login);
            if (!employee) { showToast('–ù–µ –Ω–∞–π–¥–µ–Ω', true); return; }
            if (business.employees.some(e => e.userId === employee.id)) { showToast('–£–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç', true); return; }
            
            business.employees.push({ userId: employee.id, role: 'employee' });
            saveAll(); render(); showToast(`‚úÖ ${employee.name} –Ω–∞–Ω—è—Ç`);
        }

        function renderPvpTab() {
            const opponents = users.filter(u => u.id !== currentUser.id && u.online).slice(0, 10);
            return `
                <div class="toxic-glass">
                    <h2>üî´ PVP</h2>
                    <div>–ü–æ–±–µ–¥: ${currentUser.pvpWins || 0}</div>
                    <div>–ü–æ—Ä–∞–∂–µ–Ω–∏–π: ${currentUser.pvpLosses || 0}</div>
                    <button class="toxic-btn" onclick="showPvpModal()">‚öîÔ∏è –ù–ê–ô–¢–ò –ë–û–ô</button>
                    
                    <h3>‚öîÔ∏è –°–û–ü–ï–†–ù–ò–ö–ò</h3>
                    ${opponents.map(opp => `
                        <div class="toxic-card" onclick="startPvp('${opp.id}')">
                            <span>${opp.name}</span>
                            <span>${opp.pvpWins || 0}-${opp.pvpLosses || 0}</span>
                            <span style="color:#0f0;">‚óè ONLINE</span>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function showPvpModal() {
            const opponents = users.filter(u => u.id !== currentUser.id && u.online).slice(0, 10);
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content">
                    <div class="toxic-glass">
                        <h3>üî´ –í–´–ë–ï–†–ò–¢–ï –°–û–ü–ï–†–ù–ò–ö–ê</h3>
                        ${opponents.map(opp => `
                            <div class="toxic-card" onclick="startPvp('${opp.id}'); this.closest('.modal').remove()">
                                ${opp.name} (${opp.pvpWins || 0}-${opp.pvpLosses || 0})
                            </div>
                        `).join('')}
                        <button class="toxic-btn" onclick="this.closest('.modal').remove()">–ó–∞–∫—Ä—ã—Ç—å</button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }

        function startPvp(opponentId) {
            const opponent = users.find(u => u.id === opponentId);
            const bet = prompt('–°—Ç–∞–≤–∫–∞ ($):', '100');
            if (!bet) return;
            
            const betNum = parseFloat(bet);
            if (isNaN(betNum) || betNum < 10) { showToast('–ú–∏–Ω–∏–º—É–º 10$', true); return; }
            if (currentUser.balanceUsd < betNum) { showToast('–ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ $', true); return; }
            if (opponent.balanceUsd < betNum) { showToast('–£ —Å–æ–ø–µ—Ä–Ω–∏–∫–∞ –Ω–µ—Ç –¥–µ–Ω–µ–≥', true); return; }
            
            const myPower = getTotalBonus(currentUser) * 100;
            const oppPower = getTotalBonus(opponent) * 100;
            const win = Math.random() < myPower / (myPower + oppPower);
            
            currentUser.balanceUsd -= betNum;
            opponent.balanceUsd -= betNum;
            
            if (win) {
                currentUser.balanceUsd += betNum * 2;
                currentUser.pvpWins = (currentUser.pvpWins || 0) + 1;
                opponent.pvpLosses = (opponent.pvpLosses || 0) + 1;
                showToast(`üéâ –ü–û–ë–ï–î–ê! +$${betNum}`);
            } else {
                opponent.balanceUsd += betNum * 2;
                currentUser.pvpLosses = (currentUser.pvpLosses || 0) + 1;
                opponent.pvpWins = (opponent.pvpWins || 0) + 1;
                showToast(`üò¢ –ü–û–†–ê–ñ–ï–ù–ò–ï... -$${betNum}`);
            }
            
            saveAll(); render();
        }

        function renderFriendsTab(u) {
            const friends = (u.friends || []).map(id => users.find(u => u.id === id)).filter(f => f);
            const requests = (u.friendRequests || []).map(id => users.find(u => u.id === id)).filter(r => r);
            
            return `
                <div class="toxic-glass">
                    <h2>üë• –î–†–£–ó–¨–Ø</h2>
                    <button class="toxic-btn" onclick="showAddFriendModal()">‚ûï –î–û–ë–ê–í–ò–¢–¨</button>
                    
                    ${requests.length > 0 ? `
                        <h3>üì® –ó–ê–Ø–í–ö–ò</h3>
                        ${requests.map(f => `
                            <div class="toxic-card">
                                <span>${f.name}</span>
                                <button class="toxic-btn" onclick="acceptFriend('${f.id}')">‚úì</button>
                                <button class="toxic-btn" onclick="rejectFriend('${f.id}')">‚úó</button>
                            </div>
                        `).join('')}
                    ` : ''}
                    
                    <h3>üë• –ú–û–ò –î–†–£–ó–¨–Ø</h3>
                    ${friends.map(f => `
                        <div class="toxic-card" onclick="viewProfile('${f.id}')">
                            <span class="${f.online ? 'friend-online' : 'friend-offline'}"></span>
                            <span>${f.name}</span>
                            <button class="toxic-btn" onclick="giftFriend('${f.id}'); event.stopPropagation()">üéÅ</button>
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function renderClanTab(u, userClan) {
            if (!userClan) {
                return `
                    <div class="toxic-glass">
                        <h2>‚öîÔ∏è –ö–õ–ê–ù</h2>
                        <button class="toxic-btn" onclick="showCreateClanModal()">‚öîÔ∏è –°–û–ó–î–ê–¢–¨ (1000üíé)</button>
                        <h3>–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª–∞–Ω—ã:</h3>
                        ${clans.map(clan => `
                            <div class="toxic-card" onclick="joinClan('${clan.id}')">
                                [${clan.tag}] ${clan.name} +${((clan.clanBonus-1)*100).toFixed(0)}%
                            </div>
                        `).join('')}
                    </div>
                `;
            }
            
            const rank = getClanRank(u.id);
            const canUpgrade = rank === 'founder' || rank === 'leader';
            const nextLevelPrice = clanUpgradePrices[userClan.level + 1];
            
            return `
                <div class="toxic-glass">
                    <h2>‚öîÔ∏è ${userClan.name} [${userClan.tag}]</h2>
                    <div>–£—Ä–æ–≤–µ–Ω—å: ${userClan.level}</div>
                    <div>–ë–æ–Ω—É—Å: +${((userClan.clanBonus-1)*100).toFixed(0)}%</div>
                    <div>–£—á–∞—Å—Ç–Ω–∏–∫–æ–≤: ${userClan.members.length}</div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" style="width:${(userClan.level/10)*100}%;"></div>
                    </div>
                    
                    <h3>–£—á–∞—Å—Ç–Ω–∏–∫–∏:</h3>
                    ${userClan.members.map(m => {
                        const member = users.find(u => u.id === m.userId);
                        return `
                            <div class="toxic-card" onclick="viewProfile('${member.id}')">
                                <span style="background:${m.rank==='founder'?'#f00':'#8b5cf6'}; color:#fff; padding:2px 8px; border-radius:12px;">${m.rank}</span>
                                ${member.name}
                                ${member.id === u.id ? ' (–í—ã)' : ''}
                            </div>
                        `;
                    }).join('')}
                    
                    ${canUpgrade && nextLevelPrice ? `
                        <button class="toxic-btn" onclick="upgradeClan()">‚¨ÜÔ∏è –£–ª—É—á—à–∏—Ç—å (${nextLevelPrice}üíé)</button>
                    ` : ''}
                    
                    ${canUpgrade ? `
                        <button class="toxic-btn" onclick="showChangeTagModal()">‚úèÔ∏è –°–º–µ–Ω–∏—Ç—å —Ç–µ–≥ (5000üíé)</button>
                    ` : ''}
                </div>
            `;
        }

        function renderChatTab(u, userClan) {
            const globalMessages = messages.global || [];
            const currentMessages = currentChat === 'global' ? globalMessages : (userClan ? messages.clan[userClan.id] || [] : []);
            
            return `
                <div class="toxic-glass">
                    <h2>üí¨ –ß–ê–¢</h2>
                    <div class="chat-container">
                        <div class="chat-sidebar">
                            <div class="chat-tab ${currentChat === 'global' ? 'active' : ''}" onclick="switchChat('global')">
                                üåç –û–±—â–∏–π <span class="online-count">${getOnlineCount()}</span>
                            </div>
                            ${userClan ? `
                                <div class="chat-tab ${currentChat === 'clan' ? 'active' : ''}" onclick="switchChat('clan')">
                                    ‚öîÔ∏è [${userClan.tag}]
                                </div>
                            ` : ''}
                        </div>
                        <div class="chat-main">
                            <div class="chat-messages" id="chatMessages">
                                ${currentMessages.map(msg => {
                                    const sender = users.find(u => u.id === msg.userId);
                                    if (!sender) return '';
                                    const senderClan = getUserClan(sender.id);
                                    return `
                                        <div class="chat-message ${msg.userId === u.id ? 'own' : ''}" onclick="viewProfile('${sender.id}')">
                                            <div class="sender">
                                                ${sender.name}
                                                ${senderClan ? `<span class="clan-tag">[${senderClan.tag}]</span>` : ''}
                                            </div>
                                            <div class="text">${msg.text}</div>
                                            <div class="time">${new Date(msg.time).toLocaleTimeString()}</div>
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                            <div class="chat-input-area">
                                <input type="text" class="chat-input" id="chatInput" placeholder="–°–æ–æ–±—â–µ–Ω–∏–µ...">
                                <button class="toxic-btn" onclick="sendMessage()">‚û§</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function renderVipTab(u) {
            const vipActive = u.vip?.active && u.vip.expiresAt > Date.now();
            return `
                <div class="toxic-glass">
                    <h2>üíé VIP</h2>
                    ${vipActive ? `
                        <div>üëë VIP –∞–∫—Ç–∏–≤–µ–Ω</div>
                        <div>–û—Å—Ç–∞–ª–æ—Å—å: ${getTimeLeft(u.vip.expiresAt)}</div>
                    ` : `
                        ${Object.entries(vipPrices).map(([m, p]) => `
                            <div class="toxic-card" onclick="buyVip(${m})">
                                ${m}–º - ${p}üíé
                            </div>
                        `).join('')}
                    `}
                </div>
            `;
        }

        function renderTopTab() {
            const topUsers = [...users].sort((a, b) => b.balanceUsd - a.balanceUsd).slice(0, 10);
            const topClans = [...clans].sort((a, b) => b.level - a.level).slice(0, 10);
            
            return `
                <div class="toxic-glass">
                    <h2>üèÜ –¢–û–ü-10</h2>
                    <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                        <div>
                            <h3>üí∞ –ë–æ–≥–∞—á–∏</h3>
                            ${topUsers.map((user, i) => `
                                <div class="toxic-card" onclick="viewProfile('${user.id}')">
                                    <span class="rank-badge rank-${i+1}">#${i+1}</span>
                                    ${user.name} - $${formatMoney(user.balanceUsd)}
                                </div>
                            `).join('')}
                        </div>
                        <div>
                            <h3>‚öîÔ∏è –ö–ª–∞–Ω—ã</h3>
                            ${topClans.map((clan, i) => `
                                <div class="toxic-card">
                                    <span class="rank-badge rank-${i+1}">#${i+1}</span>
                                    [${clan.tag}] ${clan.name} - –£—Ä.${clan.level}
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            `;
        }

        function renderDevPanel() {
            return `
                <div class="admin-panel-dev">
                    <h2>üëë DEV –ü–ê–ù–ï–õ–¨</h2>
                    <div>–û–Ω–ª–∞–π–Ω: ${getOnlineCount()}</div>
                    <div>–í—Å–µ–≥–æ: ${users.length}</div>
                    <div>–ö–ª–∞–Ω–æ–≤: ${clans.length}</div>
                    
                    <input type="text" id="adminUserLogin" class="input-field" placeholder="–õ–æ–≥–∏–Ω">
                    
                    <div style="display:grid; grid-template-columns:2fr 1fr; gap:5px;">
                        <input type="number" id="adminMoneyAmount" class="input-field" value="1000">
                        <button class="admin-btn-dev" onclick="adminGiveMoney()">üí∞ –í—ã–¥–∞—Ç—å $</button>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:2fr 1fr; gap:5px;">
                        <input type="number" id="adminCrystalAmount" class="input-field" value="500">
                        <button class="admin-btn-dev" onclick="adminGiveCrystals()">üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã</button>
                    </div>
                    
                    <button class="admin-btn-dev" onclick="adminGiveNFT()">üñºÔ∏è NFT</button>
                    <button class="admin-btn-dev" onclick="adminGiveMiner()">‚öôÔ∏è –ú–∞–π–Ω–µ—Ä</button>
                    <button class="admin-btn-dev" onclick="adminSetRole('ADMIN')">‚ö° ADMIN</button>
                    <button class="admin-btn-dev" onclick="adminSetRole('MODER')">üõ°Ô∏è MODER</button>
                    <button class="admin-btn-dev" onclick="adminSetRole('VIP')">üíé VIP</button>
                    <button class="admin-btn-dev" onclick="adminRemoveRole()">üë§ –°–Ω—è—Ç—å —Ä–æ–ª—å</button>
                    <button class="admin-btn-dev" onclick="adminGiveVip()">‚è∞ VIP</button>
                    <button class="admin-btn-dev" onclick="adminCheckUser()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    <button class="admin-btn-dev" onclick="adminBan()">üö´ –ë–∞–Ω</button>
                    <button class="admin-btn-dev" onclick="adminWarn()">‚ö†Ô∏è –í–∞—Ä–Ω</button>
                    <button class="admin-btn-dev" onclick="adminMute()">üîá –ú—É—Ç</button>
                    <button class="admin-btn-dev" onclick="adminClearChat()">üóëÔ∏è –ß–∞—Ç</button>
                    <button class="admin-btn-dev" onclick="adminKick()">üë¢ –ö–∏–∫</button>
                </div>
            `;
        }

        function renderAdminPanel() {
            return `
                <div class="admin-panel-admin">
                    <h2>‚ö° ADMIN –ü–ê–ù–ï–õ–¨</h2>
                    <input type="text" id="adminUserLogin" class="input-field" placeholder="–õ–æ–≥–∏–Ω">
                    
                    <div style="display:grid; grid-template-columns:2fr 1fr; gap:5px;">
                        <input type="number" id="adminMoneyAmount" class="input-field" value="1000">
                        <button class="admin-btn-admin" onclick="adminGiveMoney()">üí∞ –í—ã–¥–∞—Ç—å $</button>
                    </div>
                    
                    <div style="display:grid; grid-template-columns:2fr 1fr; gap:5px;">
                        <input type="number" id="adminCrystalAmount" class="input-field" value="500">
                        <button class="admin-btn-admin" onclick="adminGiveCrystals()">üíé –ö—Ä–∏—Å—Ç–∞–ª–ª—ã</button>
                    </div>
                    
                    <button class="admin-btn-admin" onclick="adminGiveVip()">‚è∞ VIP</button>
                    <button class="admin-btn-admin" onclick="adminCheckUser()">üîç –ü—Ä–æ–≤–µ—Ä–∏—Ç—å</button>
                    <button class="admin-btn-admin" onclick="adminWarn()">‚ö†Ô∏è –í–∞—Ä–Ω</button>
                    <button class="admin-btn-admin" onclick="adminMute()">üîá –ú—É—Ç</button>
                    <button class="admin-btn-admin" onclick="adminClearChat()">üóëÔ∏è –ß–∞—Ç</button>
                    <button class="admin-btn-admin" onclick="adminKick()">üë¢ –ö–∏–∫</button>
                </div>
            `;
        }

        function renderMain() {
            if (viewingProfile) {
                return renderProfile(viewingProfile);
            }
            
            const u = currentUser;
            const role = getUserRole(u);
            const userClan = getUserClan(u.id);
            const userBusiness = getUserBusiness(u.id);
            const totalBonus = getTotalBonus(u);
            
            let passiveIncome = 0;
            if (u.miners) {
                u.miners.forEach(m => {
                    const miner = miners.find(mn => mn.id === m.id);
                    if (miner) passiveIncome += miner.income;
                });
            }
            if (userBusiness) passiveIncome += userBusiness.income;
            passiveIncome *= totalBonus;

            return `
                <div>
                    <div class="profile-header">
                        <div class="profile-card" onclick="viewProfile('${u.id}')">
                            <div class="avatar">
                                ${u.name.charAt(0)}
                                ${userClan ? `<span class="clan-tag-badge">${userClan.tag}</span>` : ''}
                                <span class="role-badge badge-${role.toLowerCase()}">${role}</span>
                            </div>
                            <div>
                                <span style="font-size:24px;">${u.name}</span>
                                ${u.telegram ? `<div class="telegram-badge">üì± ${u.telegram}</div>` : ''}
                                ${u.youtube ? `<div class="youtube-badge">‚ñ∂Ô∏è ${u.youtube}</div>` : ''}
                                <div>ID: ${u.id.slice(0,8)}</div>
                            </div>
                        </div>
                        
                        <div class="balances">
                            <div class="balance-item usd"><span>üí∞</span><span class="balance-value">$${formatMoney(u.balanceUsd)}</span></div>
                            <div class="balance-item crystal"><span>üíé</span><span class="balance-value">${Math.floor(u.balanceCrystal)}</span></div>
                        </div>
                        
                        <div style="display:flex; gap:10px;">
                            <button class="toxic-btn" onclick="editContacts()">üì± –ö–û–ù–¢–ê–ö–¢–´</button>
                            <button class="toxic-btn" onclick="showTransferModal()">üí∏ –ü–ï–†–ï–í–û–î</button>
                            ${role === 'DEV' || role === 'ADMIN' ? 
                                `<button class="toxic-btn" onclick="toggleAdminPanel()">${showAdminPanel ? 'üîΩ –°–ö–†–´–¢–¨' : 'üëë –ê–î–ú–ò–ù'}</button>` : ''}
                            <button class="toxic-btn" onclick="logout()">üö™ –í–´–ô–¢–ò</button>
                        </div>
                    </div>

                    <div class="toxic-tabs">
                        <button class="toxic-tab ${currentTab === 'mine' ? 'active' : ''}" onclick="switchTab('mine')">‚õèÔ∏è –ú–ê–ô–ù–ò–ù–ì</button>
                        <button class="toxic-tab ${currentTab === 'crypto' ? 'active' : ''}" onclick="switchTab('crypto')">üìà –ö–†–ò–ü–¢–û</button>
                        <button class="toxic-tab ${currentTab === 'games' ? 'active' : ''}" onclick="switchTab('games')">üé≤ –ò–ì–†–´</button>
                        <button class="toxic-tab ${currentTab === 'auction' ? 'active' : ''}" onclick="switchTab('auction')">üè™ –ê–£–ö–¶–ò–û–ù</button>
                        <button class="toxic-tab ${currentTab === 'business' ? 'active' : ''}" onclick="switchTab('business')">üè¢ –ë–ò–ó–ù–ï–°</button>
                        <button class="toxic-tab ${currentTab === 'pvp' ? 'active' : ''}" onclick="switchTab('pvp')">üî´ PVP</button>
                        <button class="toxic-tab ${currentTab === 'friends' ? 'active' : ''}" onclick="switchTab('friends')">üë• –î–†–£–ó–¨–Ø</button>
                        <button class="toxic-tab ${currentTab === 'clan' ? 'active' : ''}" onclick="switchTab('clan')">‚öîÔ∏è –ö–õ–ê–ù</button>
                        <button class="toxic-tab ${currentTab === 'chat' ? 'active' : ''}" onclick="switchTab('chat')">üí¨ –ß–ê–¢</button>
                        <button class="toxic-tab ${currentTab === 'vip' ? 'active' : ''}" onclick="switchTab('vip')">üíé VIP</button>
                        <button class="toxic-tab ${currentTab === 'top' ? 'active' : ''}" onclick="switchTab('top')">üèÜ –¢–û–ü</button>
                    </div>

                    ${currentTab === 'mine' ? renderMiningTab(u, totalBonus, passiveIncome) : ''}
                    ${currentTab === 'crypto' ? renderCryptoTab(u) : ''}
                    ${currentTab === 'games' ? renderGamesTab() : ''}
                    ${currentTab === 'auction' ? renderAuctionTab() : ''}
                    ${currentTab === 'business' ? renderBusinessTab(u, userBusiness) : ''}
                    ${currentTab === 'pvp' ? renderPvpTab() : ''}
                    ${currentTab === 'friends' ? renderFriendsTab(u) : ''}
                    ${currentTab === 'clan' ? renderClanTab(u, userClan) : ''}
                    ${currentTab === 'chat' ? renderChatTab(u, userClan) : ''}
                    ${currentTab === 'vip' ? renderVipTab(u) : ''}
                    ${currentTab === 'top' ? renderTopTab() : ''}

                    ${showAdminPanel && role === 'DEV' ? renderDevPanel() : ''}
                    ${showAdminPanel && role === 'ADMIN' ? renderAdminPanel() : ''}
                </div>
            `;
        }

        function logout() {
            if (currentUser) {
                currentUser.online = false;
                currentUser.lastSeen = Date.now();
                saveAll();
            }
            currentUser = null;
            localStorage.removeItem('cryptoBankSession');
            render();
            showToast('–í—ã –≤—ã—à–ª–∏');
        }

        // ==================== –†–ï–ù–î–ï–† (–û–°–ù–û–í–ù–û–ô) ====================
        function render() {
            const app = document.getElementById('app');
            if (!app) return;
            
            try {
                if (!currentUser) {
                    app.innerHTML = renderAuth();
                    setTimeout(() => attachAuthEvents(), 100);
                } else {
                    app.innerHTML = renderMain();
                    
                    // –ü—Ä–æ–∫—Ä—É—Ç–∫–∞ —á–∞—Ç–∞ –≤–Ω–∏–∑
                    const chatMessages = document.getElementById('chatMessages');
                    if (chatMessages) chatMessages.scrollTop = chatMessages.scrollHeight;
                }
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞:', error);
                app.innerHTML = `
                    <div class="error-container">
                        <h2 class="error-title">‚ö†Ô∏è –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏</h2>
                        <button class="error-btn" onclick="clearAllData()">üîÑ –û–ß–ò–°–¢–ò–¢–¨ –î–ê–ù–ù–´–ï</button>
                    </div>
                `;
            }
        }

        // ==================== –§–û–ù–û–í–´–ï –ü–†–û–¶–ï–°–°–´ ====================
        setInterval(() => {
            if (currentUser) {
                currentUser.online = true;
                currentUser.lastSeen = Date.now();
            }
            users.forEach(u => {
                if (u.id !== currentUser?.id && u.lastSeen && Date.now() - u.lastSeen > 60000) {
                    u.online = false;
                }
            });
            saveAll();
        }, 30000);

        setInterval(() => {
            if (currentUser) {
                let income = 0;
                if (currentUser.miners) {
                    currentUser.miners.forEach(m => {
                        const miner = miners.find(mn => mn.id === m.id);
                        if (miner) income += miner.income;
                    });
                }
                const business = getUserBusiness(currentUser.id);
                if (business) income += business.income;
                const bonus = getTotalBonus(currentUser);
                currentUser.balanceUsd += income * (bonus || 1);
                saveAll();
            }
        }, 1000);

        setInterval(() => {
            if (currentUser && currentUser.autoClicker) {
                const bonus = getTotalBonus(currentUser);
                currentUser.balanceUsd += 1 * (bonus || 1);
                currentUser.totalClicks++;
                saveAll();
            }
        }, 1000);

        setInterval(() => {
            for (let coin in cryptoRates) {
                let change = (Math.random() - 0.5) * 0.05;
                cryptoRates[coin] = cryptoRates[coin] * (1 + change);
                if (cryptoRates[coin] < 1) cryptoRates[coin] = 1;
            }
            if (currentUser && currentTab === 'crypto') render();
        }, 5000);

        // ==================== –ó–ê–ü–£–°–ö ====================
        loadData();
        render();
    </script>
</body>
</html>